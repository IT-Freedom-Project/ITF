Скрипт настраивает базовую безопасность VPS. Вы будете выбирать, какие операции провести, и будете вводить необходимые значения. Скрипт запускается непосредственно не VPS, который нужно настроить.

Для запуска скрипта выполняем эту команду:

```sudo wget -O security-itf.sh https://raw.githubusercontent.com/IT-Freedom-Project/ITF/main/Obhod-blokirovok/Nastrojka-Bezopasnosti/security-itf.sh && sudo bash security-itf.sh```

или эту:

```sudo curl -o security-itf.sh https://raw.githubusercontent.com/IT-Freedom-Project/ITF/main/Obhod-blokirovok/Nastrojka-Bezopasnosti/security-itf.sh && sudo bash security-itf.sh```

Что происходит при запуске скрипта:

1 Хотите обновить систему? (yes/no): вам предложат обновить систему. Лучше обновить. После обновления может возникнуть синий экран с выбором сервисов для перезагрузки. Просто нажмите Enter.

2 Хотите изменить пароль root? (yes/no): вам предложат изменить пароль встроенного системного пользователя-администратора Linux - root. Лучше поменять.

2.1 Введите пароль и подтверждение пароля.
- Пароль должен быть не менее 16 символов.
- Пароль должен содержать хотя бы одну букву нижнего регистра (латинскую или русскую).
- Пароль должен содержать хотя бы одну букву верхнего регистра (латинскую или русскую).
- Пароль должен содержать хотя бы одну цифру.
- Пароль должен содержать хотя бы один специальный символ.

3 Хотите создать нового пользователя? (yes/no):  вам предложат создать нового пользователя-администратора Linux. Лучше создать и заходить в систему уже под его аккаунтом. Если хотите поменять пароль уже существующего пользователя, просто напишите его имя при создании.

3.1 Введите имя пользователя. Имя пользователя должно быть от 1 до 32 символов. Имя пользователя должно начинаться с буквы или подчеркивания, и содержать только строчные буквы, цифры, дефисы и подчеркивания.

3.2 Введите пароль (требования как в 2.1)

3.3. Разрешить выполнение команд без пароля? (yes/no): вам предложит добавить пользователя в группу выполнения команд без ввода пароля в sudo. Это надо, например, для Amnezia, если вы там указываете не root пользователя в настройках подключения к серверу. Скрипт предложит отключить эту настройку, если она уже включена.

4 Хотите отключить вход root по SSH? (yes/no): вам предложат отключить вход через ssh для root пользователя. Лучше отключить ЕСЛИ ВЫ УЖЕ СОЗДАЛИ ДРУГОГО ПОЛЬЗОВАТЕЛЯ и можете войти под его данными. Под аккаунтом root через ssh на сервер будет больше не попасть. Скрипт предложит отключить эту настройку, если она уже включена.

5 Хотите изменить порт SSH? (yes/no): вам предложат изменить порт для SSH по умолчанию. Лучше изменить. Диапазон 1024-65535. При смене порта ufw будет отключён, если он активен.

6 Хотите настроить ufw? (yes/no): вам предложат настроить файрволл, который закрывает входящий трафик на все порты, кроме текущего порта ssh. Лучше настроить.

7 Хотите настроить fail2ban? (yes/no): вам предложат настроить систему защиту от брутфорса на ssh порту. Лучше настроить.

8 qemu-guest-agent установлен и активен. Хотите остановить и отключить его? (yes/no): вам предложат отключить службу, через которую хостер может управлять системой на VPS (сбросить пароль для root и пр.). При этом в личном кабинете не будет видна статистика нагрузки VPS и сбросить пароль для root вы больше не сможете, что может быть неудобно. Учтите, хостинг всё равно может иметь доступ к файловой системе вашего сервера. Скрипт предложит включить службу обратно, если она уже отключена. Отключать или нет - дело вкуса и конкретной ситуации.


А теперь если настраиваем безопасность руками, а не скриптом:

1. Обновляем систему:
sudo apt update
sudo apt upgrade -y

2. Меняем пароль root:
sudo passwd root

3. Создаём нового пользователя (напишите имя вместо <username>):
sudo adduser <username>

4. Добавьте пользователя в группу sudo, чтобы он мог выполнять команды от имени суперпользователя (напишите имя вместо <username>):
sudo usermod -aG sudo <username>

5. Если вы хотите разрешить пользователю выполнять команды без ввода пароля (напишите имя вместо <username>): 
echo '<username> ALL=(ALL) NOPASSWD:ALL' | sudo tee /etc/sudoers.d/<username>

6. Отключение или включение доступа root по SSH:

   Откройте файл конфигурации SSH:
   sudo nano /etc/ssh/sshd_config

   Найдите строку PermitRootLogin и измените её значение на no, чтобы отключить доступ root по SSH:
   PermitRootLogin no

   Или на yes, чтобы включить доступ root по SSH:
   PermitRootLogin yes

   Нажмите Ctrl + O, Enter, Ctrl + X чтобы сохранить изменения.

   Перезапустите службу SSH:
   sudo systemctl restart sshd || sudo systemctl restart ssh

7. Изменение порта SSH:
   Отключите UFW (если он активен) перед изменением порта:
   sudo ufw disable

   Откройте файл конфигурации SSH:
   sudo nano /etc/ssh/sshd_config

   Найдите или добавьте строку Port и установите нужный вам порт (например, 2222):
   Port 2222

   Нажмите Ctrl + O, Enter, Ctrl + X чтобы сохранить изменения.
   
   Перезапустите службу SSH:
   sudo systemctl restart sshd || sudo systemctl restart ssh
  
